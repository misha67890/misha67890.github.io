!function(e){function t(n){if(i[n])return i[n].exports;var r=i[n]={i:n,l:!1,exports:{}};return e[n].call(r.exports,r,r.exports,t),r.l=!0,r.exports}var i={};return t.m=e,t.c=i,t.d=function(e,i,n){t.o(e,i)||Object.defineProperty(e,i,{enumerable:!0,get:n})},t.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},t.t=function(e,i){if(1&i&&(e=t(e)),8&i)return e;if(4&i&&"object"==typeof e&&e&&e.__esModule)return e;var n=Object.create(null);if(t.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:e}),2&i&&"string"!=typeof e)for(var r in e)t.d(n,r,function(t){return e[t]}.bind(null,r));return n},t.n=function(e){var i=e&&e.__esModule?function(){return e["default"]}:function(){return e};return t.d(i,"a",i),i},t.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},t.p="",t(t.s=398)}({276:function(e,t,i){"use strict";function n(e){return e&&e.clipboardData?e.clipboardData:e&&e.originalEvent&&e.originalEvent.clipboardData?e.originalEvent.clipboardData:window.clipboardData}function r(e){var t=n(e);if(!t)return[];var i=t.items;if(!i)return[];for(var r=[],s=0;s<i.length;s++)0==i[s].type.indexOf("image")&&r.push(i[s].getAsFile());return r}function s(){if(!d){var e=ge("utils");d=ce("div",{},{width:"10px",height:"10px",overflow:"hidden"}),attr(d,"contenteditable","true"),e.appendChild(d)}}function o(e){return new l(function(t,i){if(u)return cancelEvent(e),i();var n=Object(a.rangeGet)(),r=h(n,5),o=r[0],c=r[1],p=r[2],f=r[3],g=r[4];if(o){if("paste"===e.type){var v=e.clipboardData||e.originalEvent&&e.originalEvent.clipboardData;if(v&&v.types&&v.getData){cancelEvent(e),u=!0;var b=v.getData("text/html")||clean(v.getData("text/plain"))||"";return t([b,function(e){Object(a.rangeInsert)(o,e),u=!1}])}for(var w=cf(),m=e.target||window.event.srcElement;m.firstChild;)w.appendChild(m.firstChild);return new l(function(e){return setTimeout(function(){var t=m.innerHTML||"";m.innerHTML="",m.appendChild(w),e([t,function(e){o=Object(a.rangeCreate)(c,p,f,g),Object(a.rangeInsert)(o,e),u=!1}])},0)})}if("beforepaste"===e.type)return u=!0,s(),d.focus(),void(d.onpaste=function(){setTimeout(function(){var e=d.innerHTML||"";d.innerHTML="",delete d.onpaste,t([e,function(e){o=Object(a.rangeCreate)(c,p,f,g),Object(a.rangeInsert)(o,e),u=!1}])},0)})}return i()})}i.r(t),i.d(t,"getFiles",function(){return r}),i.d(t,"clipboardProcessPaste",function(){return o});var a=i(587),c=i(467),h=function(){function e(e,t){var i=[],n=!0,r=!1,s=void 0;try{for(var o,a=e[Symbol.iterator]();!(n=(o=a.next()).done)&&(i.push(o.value),!t||i.length!==t);n=!0);}catch(c){r=!0,s=c}finally{try{!n&&a["return"]&&a["return"]()}finally{if(r)throw s}}return i}return function(t,i){if(Array.isArray(t))return t;if(Symbol.iterator in Object(t))return e(t,i);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}(),l=c.Promise,u=!1,d=null},364:function(e,t){var i;i=function(){return this}();try{i=i||Function("return this")()||(1,eval)("this")}catch(n){"object"==typeof window&&(i=window)}e.exports=i},377:function(e,t,i){"use strict";function n(e,t){var i=this;this.cont=ge(e),this.imgWidth=400,extend(this,t),cur._wkeId=(cur._wkeId||0)+1,cur._wke=cur._wke||{},cur._wke[cur._wkeId]=this,cur.imagesInfo||(cur.imagesInfo={}),this.cont.setAttribute("contenteditable","true"),this.cont.setAttribute("spellcheck","true");var n="keydown mouseup keyup focus blur click copy cut paste beforepaste";addEvent(e,n,function(e){this.textEvent(e)}.bind(this)),cur.destroy.push(function(){removeEvent(e,n)}),this.plainMode=!1,this.inst="cur._wke["+cur._wkeId+"]";var r="";t.mode&&(this.mode=0,this.modeBtn=t.mode,r='<a id="wke_b_mode" class="wke_b wke_b_mode" wiki="mode" tooltip="'+t.mode[0]+'" onmousedown="'+this.inst+'.button(this, event);" onmouseover="'+this.inst+'.ttOver(this, true);"></a>'),r+='<a id="wke_b_help" class="wke_b wke_b_help" wiki="help" tooltip="'+t.help[0]+'" onmousedown="'+this.inst+'.button(this, event);" onmouseover="'+this.inst+'.ttOver(this, true);"></a>';var s='<div id="wke_controls" class="wke_controls clear_fix"><div class="wke_loader"></div>'+r+'<div class="wke_panel clear_fix">';for(var o in this.buttons){var a=this.buttons[o];s+='<a id="wke_b_'+o+'" class="wke_b wke_b_'+o+'" wiki="'+o+'" tooltip="'+a[0]+'" onmousedown="'+this.inst+'.button(this, event);" onmouseover="'+this.inst+'.ttOver(this);"></a>'}s+="</div></div>",this.panelCont?this.panelCont.innerHTML=s:(this.panelCont=ce("div",{innerHTML:s,id:"wke_controls_cont"}),this.cont.parentNode.insertBefore(this.panelCont,this.source||this.cont)),addClass(this.panelCont,"wke_pcont"),this.panel=ge("wke_controls"),this.loader=geByClass1("wke_loader",this.panel),this.mode=1,this.state={},this.panelXY=getXY(this.panel,this.isLayer),t.source?this.textarea=this.source:this.textarea=this.cont.parentNode.insertBefore(ce("textarea"),this.cont),addClass(this.textarea,"wke_textarea"),autosizeSetup(this.textarea,{minHeight:t.minHeight||400}),addEvent(this.textarea,"keydown",function(e){this.textEvent(e)}.bind(this));var c=this.saveLastCursor.bind(this);addEvent(document,"mousedown",c),cur.destroy.push(function(){removeEvent(i.textarea,"keydown"),removeEvent(document,"mousedown",c)}),this.pboxParams=t.pboxParams||{},this.checkBrowser(),setTimeout(function(){this.prepareCont(this.cont)}.bind(this))}i.r(t);var r=i(276),s=function(){function e(e,t){var i=[],n=!0,r=!1,s=void 0;try{for(var o,a=e[Symbol.iterator]();!(n=(o=a.next()).done)&&(i.push(o.value),!t||i.length!==t);n=!0);}catch(c){r=!0,s=c}finally{try{!n&&a["return"]&&a["return"]()}finally{if(r)throw s}}return i}return function(t,i){if(Array.isArray(t))return t;if(Symbol.iterator in Object(t))return e(t,i);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}();extend(n.prototype,{textEvent:function(e){if("keydown"==e.type)switch(this.lastKey=e.keyCode,e.keyCode){case KEY.ENTER:if(this.onChangeHandler(),this.plainMode)break;if(this.state.pre){var t=document.createTextNode("\n");this.replaceSelected([t]);for(var i=t.nextSibling;i&&""==i.nodeValue;)i=i.nextSibling;return i||t.parentNode.insertBefore(document.createTextNode("\n"),t),this.setFocus(t),cancelEvent(e)}var n=this.getRange(),r=this.getState(n);if(r&&2==r[1]){var s=r[0],o=ce("br");if(!n.endOffset&&this.getText(s)){var a=this.prevNode(s);a&&"BR"!=a.tagName&&(3!=a.nodeType||a.data)&&s.parentNode.insertBefore(ce("br"),s),s.parentNode.insertBefore(o,s),this.setFocus(s,{toStart:!0})}else this.insertBreak(e,s);return cancelEvent(e)}break;case KEY.LEFT:case KEY.RIGHT:case KEY.UP:case KEY.DOWN:case KEY.ESC:case 17:case 16:case 18:case 91:break;case 66:(e.ctrlKey||e.metaKey)&&this.button(ge("wke_b_bold"),e);break;case 73:(e.ctrlKey||e.metaKey)&&this.button(ge("wke_b_italic"),e);break;default:this.onChangeHandler()}else if("mouseup"==e.type||"keyup"==e.type)this.checkEditPlace();else if("focus"==e.type)this.checkEditPlace();else if("blur"==e.type)this.switchMode(0);else if("click"==e.type){var c=e.target;if(this.isLink(c))return this.showUrlBox([c,3]),cancelEvent(e);var h=this.isPhoto(c);if(h)return this.showPhotoBox(h),cancelEvent(e);if(c==this.cont&&browser.opera)return this.setFocus(this.cont),cancelEvent(e)}else if("cut"!=e.type&&"copy"!=e.type||this.plainMode)"beforepaste"!==e.type&&"paste"!==e.type||this.plainMode||this.filterPastedContent(e);else{var l=geByTag("img",this.cont);l=Array.prototype.slice.apply(l);for(var u in l){var d=l[u].parentNode;d&&"A"==d.tagName&&(cur.imagesInfo[l[u].src]=[d.getAttribute("onclick"),d.getAttribute("wiki"),d.getAttribute("href")])}}},filterPastedContent:function(e){var t=this;Object(r.clipboardProcessPaste)(e).then(function(e){var i=s(e,2),n=i[0],r=i[1];n.length>3e5&&(n=n.substr(0,3e5)),n&&(n=n.replace(/<\s*([^\t\n\f \/>"'=]+)([^\>]*?(?:(['"]).*?\3[^\>]*?|[^\>])*?)>(?:.*?<\s*\/\s*\1[^\>]*?(?:(['"]).*?\3[^\>]*?|[^\>])*?>)?/gi,function(e,t){return~["style","meta","link","script","embed","object","applet"].indexOf(t.toLowerCase())?"":e}),n=n.replace(/<\s*([^\t\n\f \/>"'=]+)([^\>]*?(?:(['"]).*?\3[^\>]*?|[^\>])*?)>/g,function(e,t,i){return i?(i=i.replace(/\bon\w+\s*=\s*(?:(["']).*?\1|[^\s\/]+)/gi,""),i=i.replace(/\bstyle\s*=\s*((["']).*?\2|[^\s\/]+)/gi,function(e,t){return"style="+t.replace(/(?:-webkit-)?position\s*:\s*(sticky|absolute|fixed);?/gi,"")})):i="","<"+t+i+">"})),r(n);var o=geByTag("img",t.cont);o=[].slice.apply(o);for(var a in o){var c=o[a].parentNode;if("A"!=c.tagName||!attr(c,"wiki")){var h=cur.imagesInfo[o[a].src];if("A"!=c.tagName){var l=getSize(o[a]);if(!l[0])continue;var u=ce("a",{innerHTML:'<img width="'+l[0]+'" height="'+l[1]+'" src="'+o[a].src+'" />',contentEditable:"false",className:"wk_photo"});c.replaceChild(u,o[a]),c=u}attr(c,"onclick",h[0]),attr(c,"wiki",h[1]),attr(c,"href",h[2])}}})["catch"](function(){})},insertBreak:function(e,t){var i=ce("div",{innerHTML:"<br/>"});return t?t.nextSibling?t.parentNode.insertBefore(i,t.nextSibling):t.parentNode.appendChild(i):this.cont.appendChild(i),this.setFocus(i,{toStart:!0}),cancelEvent(e)},showBox:function(e){function t(){return e.apply(this,arguments)}return t.toString=function(){return e.toString()},t}(function(){this.plainMode?cur.wkBoxRange=this.plainGetSel():cur.wkBoxRange=this.getRange();var e=showBox.apply(window,arguments);return e?(e.setOptions({onHide:function(){cur.wkBoxRange&&this.setSelectionRange(cur.wkBoxRange)}.bind(this)}),e):!1}),checkFocus:function(){if(!browser.chrome)return!1;var e=this.getSel();if(e&&"None"!=e.type){var t=e.focusNode;if(t!=this.cont)for(;t;){if(t==this.cont)return!1;t=t.parentNode}}this.setFocus(this.cont)},toggleEditable:function(e){var t=geByClass("wk_photo",this.cont);t.push.apply(t,geByClass("wk_photo_no_padding",this.cont));for(var i in t)t[i].setAttribute("contenteditable",e?"false":"true")},button:function(e,t){if(hasClass(e,"wke_b_disabled"))return cancelEvent(t);var i=e.getAttribute("wiki"),n=this.buttons[i],r=document;switch(this.plainMode||this.checkFocus(),i){case"bold":this.plainMode?this.plainInsert("'''","'''"):(r.execCommand("bold",!1,null),this.toggleState(i));break;case"italic":this.plainMode?this.plainInsert("''","''"):(r.execCommand("italic",!1,null),this.toggleState(i));break;case"image":var s=extend({act:"choose_photo",al_wiki_editor:1,is_blog_editor:-1!=location.href.indexOf("/blog")?1:0,to_id:cur.oid,scrollbar_width:window.sbWidth()},this.pboxParams);this.pbox=this.showBox("al_photos.php",s,{stat:["page.css","page.js"],cache:1}),window.editorChoosePhoto=this.insertPhoto.bind(this);break;case"video":this.vbox=this.showBox("al_video.php",{act:"a_choose_video_box",al_wiki_editor:1,to_id:cur.oid,scrollbar_width:window.sbWidth()},{stat:["page.css","page.js"],cache:1}),window.editorChooseVideo=this.insertVideo.bind(this);break;case"audio":this.abox=this.showBox("audio.php",{act:"a_choose_audio_box",al_wiki_editor:1,to_id:cur.oid,scrollbar_width:window.sbWidth(),options:JSON.stringify({wiki:1})},{stat:["page.css","page.js"],cache:1}),window.editorChooseAudio=this.insertAudio.bind(this);break;case"left":this.plainMode?this.plainInsert("<left>","</left>"):(this.toggleEditable(!1),r.execCommand("justifyLeft",!1,!0),this.toggleEditable(!0),this.toggleState(i));break;case"center":this.plainMode?this.plainInsert("<center>","</center>"):(this.toggleEditable(!1),r.execCommand("justifyCenter",!1,!0),this.toggleEditable(!0),this.toggleState(i));break;case"right":this.plainMode?this.plainInsert("<right>","</right>"):(this.toggleEditable(!1),r.execCommand("justifyRight",!1,!0),this.toggleEditable(!0),this.toggleState(i));break;case"h1":this.plainMode?this.plainInsert("== "," ==",{newline:1}):this.wrapHeader("wk_header",n);break;case"h2":this.plainMode?this.plainInsert("=== "," ===",{newline:1}):this.wrapHeader("wk_sub_header",n);break;case"h3":this.plainMode?this.plainInsert("==== "," ====",{newline:1}):this.wrapHeader("wk_sub_sub_header",n);break;case"url":var o=this.getState(this.getRange());this.showUrlBox(o,!0);break;case"list":this.plainMode?this.plainInsert("* ","",{newline:1}):this.wrapList("ul",n);break;case"blockquote":this.plainMode?this.plainInsert("<blockquote>","</blockquote>",{newline:1}):this.wrapEl("blockquote",n,"<div>","</div>");break;case"mode":this.togglePlainMode(),this.toggleState(i);break;case"help":showBox("al_pages.php",{act:"markup_help"},{stat:["pages.css"]})}return"mode"!=i&&this.onChangeHandler(),cancelEvent(t)},checkBrowser:function(){var e=intval(browser.version),t=!1;browser.chrome&&e>11&&(t=1),browser.mozilla&&e>=4&&(t=1),browser.opera&&e>10&&(t=1),browser.safari&&e>4&&(t=1),browser.msie&&e>=9&&(t=1);var i=ge("wke_b_mode");t&&!this.plain?(show(this.cont),hide(this.textarea),this.setPlainMode(!1),this.modeBtn&&this.ttUpdate(i,this.modeBtn[0])):(hide(this.cont),show(this.textarea),this.setPlainMode(!0),this.modeBtn&&this.ttUpdate(i,this.modeBtn[1]),t||hide(i)),this.onPlainToggle&&this.onPlainToggle(!t,!1),this.checkEditPlace()},setPlainMode:function(e){this.plainMode=e,triggerEvent(window,"scroll")},togglePlainMode:function(e){var t=ge("wke_b_mode"),i=void 0;(void 0==e?this.plainMode:e)?(i=this.textarea.value,i==this.prevWiki?(show(this.cont),hide(this.textarea),this.setPlainMode(!1),triggerEvent(window,"scroll")):ajax.post("al_pages.php",{act:"convert_wiki",Body:i},{onDone:function(e,t){this.wikiPref=t,this.cont.innerHTML=e,show(this.cont),this.prepareCont(this.cont),hide(this.textarea),this.setPlainMode(!1),this.onPlainToggle&&this.onPlainToggle(this.plainMode,!0)}.bind(this),loader:!0}),this.ttUpdate(t,this.modeBtn[0])):(this.changed?(i=this.val(),this.prevWiki=i,val(this.textarea,i),this.textarea.autosize&&this.textarea.autosize.update()):this.prevWiki=this.textarea.value,hide(this.cont),show(this.textarea),this.setPlainMode(!0),this.ttUpdate(t,this.modeBtn[1])),this.onPlainToggle&&this.onPlainToggle(this.plainMode,!0),window.WkView&&WkView.onResize()},prepareCont:function(e){for(var t=geByTag("blockquote",e),i=t.length;i--;){var n=t[i];if(!n.firstChild||"DIV"!=n.firstChild.tagName){for(var r=document.createDocumentFragment();n.firstChild;)r.appendChild(n.firstChild);var s=ce("div");s.appendChild(r),n.appendChild(s)}}var o=geByClass("wk_photo",e);for(o.push.apply(o,geByClass("wk_photo_no_padding",e)),o.push.apply(o,geByClass("wk_video",e)),o.push.apply(o,geByClass("audio_row",e)),i=o.length;i--;)o[i].setAttribute("contenteditable","false")},plainGetSel:function(){var e=0,t=0,i=void 0;if(document.selection){i=!0;var n=document.selection.createRange();if(n&&n.parentElement()==this.textarea){var r=this.textarea.value,s=r.length,o=r.replace(/\r\n/g,"\n"),a=this.textarea.createTextRange();a.moveToBookmark(n.getBookmark());var c=this.textarea.createTextRange();c.collapse(!1),a.compareEndPoints("StartToEnd",c)>-1?e=t=s:(e=-a.moveStart("character",-s),browser.msie&&intval(browser.version)<9&&(e+=o.slice(0,e).split("\n").length-1),a.compareEndPoints("EndToEnd",c)>-1?t=s:(t=-a.moveEnd("character",-s),browser.msie&&intval(browser.version)<9&&(t+=o.slice(0,t).split("\n").length-1)))}}else this.textarea.selectionStart||"0"==this.textarea.selectionStart?(e=this.textarea.selectionStart,t=this.textarea.selectionEnd):t=e=this.textarea.value.length;return[e,t,i]},plainInsert:function(e,t,i){this.textarea.focus(),e=e||"",t=t||"",i=i||{};var n=e.length,r=t.length,s=this.plainGetSel(),o=s[0],a=s[1],c=this.textarea.value.substr(0,o),h=this.textarea.value.substr(o,a-o),l=this.textarea.value.substr(a,this.textarea.value.length-a),u=h.match(this.re.endSp);if(u){var d=u[0].length;h=h.substr(0,h.length-d),a-=d,l=u[0]+l}if(i.replace&&(h=""),o>=n&&c.substr(o-n,o)==e&&l.substr(0,r)==t)e="",t="",c=c.substr(0,o-n),l=l.substr(r),o-=n,a-=n;else if(o+=n,a+=n,i.newline){"\n"!=c.substr(-1)&&(c+="\n",o+=1,a+=1);var p=l.substr(0,1);"\n"!=p&&"\r"!=p&&(l="\n"+l)}this.textarea.value=c+e+h+t+l,setTimeout(function(){this.plainFocus(this.textarea,o,a)}.bind(this),0)},wrapHeader:function(e,t){var i=this.getRange(),n=this.getState(i),r=n[0];r.className==e?this.unsurround(r):(2==n[1]&&this.unsurround(r),this.surround(ce("div",{className:e}),t[1])),this.checkEditPlace()},wrapEl:function(e,t,i,n){var r=this.getRange(),s=this.getState(r),o=s[0];o.tagName==e.toUpperCase()?this.unsurround(o):(6==s[1]&&this.unsurround(o),this.surround(ce(e),t[1],i,n)),this.checkEditPlace()},wrapList:function(e,t){var i=this.getRange(),n=this.getState(i),r=n[0];if(5==n[1]&&geByTag("li",r).length){for(var s=r.firstChild,o=document.createDocumentFragment();s;){if("LI"==s.tagName){for(var a=ce("div");s.firstChild;)a.appendChild(s.firstChild);o.appendChild(a)}s=s.nextSibling}var c=o.firstChild,h=o.lastChild;r.parentNode.replaceChild(o,r),this.setSelection(c,h)}else this.surround(ce(e,{className:"listing"}),t[1],'<li><span class="l">',"</span></li>",!0);this.checkEditPlace()},fixHeader:function(e){e.parentNode.replaceChild(ce("div",{className:e.className,innerHTML:clean(this.getText(e))}),e)},fixList:function(e){for(var t=e.firstChild;t;){var i=t;if(t=t.nextSibling,1==i.nodeType&&"SPAN"!=i.tagName||3==i.nodeType){var n=ce("span",{className:"l"});i.parentNode.replaceChild(n,i),n.appendChild(i)}}},showUrlBox:function(e,t){var i=void 0;if(this.plainMode)cur.wkBoxRange=this.plainGetSel(),i=this.textarea.value.substr(cur.wkBoxRange[0],cur.wkBoxRange[1]-cur.wkBoxRange[0]);else if(3==e[1]){var n=e[0];if(i=this.getText(n),cur.wkLinkHref=n.getAttribute("href"),cur.wkLinkNote=cur.wkLinkHref.match(this.re.noteHref),cur.wkLinkPage=cur.wkLinkHref.match(this.re.pageWikiHref),cur.wkLinkCustomPage=cur.wkLinkHref.match(this.re.pageHref),cur.wkBoxRange=this.setFocus(n,{noCollapse:!0}),cur.wkLinkEl=n,t)return this.unsurround(n,!0),this.checkEditPlace(),!1}else i=document.getSelection?document.getSelection()+"":document.selection?document.selection.createRange().text+"":"",cur.wkBoxRange=this.getRange();cur.wkLinkName=i,cur.isBLogEditor&&(cur.wkLinkNote=cur.wkLinkPage=cur.wkLinkCustomPage=null);var r=showBox("wiki.php",{act:"link_box_new",note:""|this.note,page:this.page||"",oid:this.oid},{cache:1});r.editor=this,r.setOptions({onHide:function(){cur.wkBoxRange&&this.setSelectionRange(cur.wkBoxRange)}.bind(this)})},showPhotoBox:function(e){var t=geByTag1("IMG",e);if(!t)return!1;var i=e.getAttribute("href"),n="",r=(i||"").match(this.re.photoHref),s=void 0,o=void 0;if(r)s=r[1],o=(r[2]||"").substr(1);else{var a=e.getAttribute("wiki");a&&(r=a.split("_"),s=r[0],o=r[1]);var c=void 0;n=i,n=(c=i.match(this.re.away))?decodeURIComponent(c[1]):i}if(!s||!o)return!1;var h=e.getAttribute("title");cur.wkPhotoEditParams={el:t,oid:s,pid:o,text:h||"",url:n,saveRatio:!0},cur.wkSavePhoto=function(i,n,r,a){var c=this.getPhotoHTML(s,o,t.src,i,n,r,a);e.parentNode.replaceChild(se(c),e)}.bind(this),cur.wkBoxRange=this.getRange();var l=showBox("wiki.php",{act:"photo_box_new"},{cache:1});l.setOptions({onHide:function(){cur.wkBoxRange&&this.setSelectionRange(cur.wkBoxRange)}.bind(this)})},getLinkWiki:function(e,t,i){var n=void 0,r=void 0;"/"==e[0]&&(e="./"+e);var s="[",o="]";if(n=e.match(this.re.away))e=decodeURIComponent(n[1]);else if((r=e.match(this.re.pageHref))&&!cur.isBLogEditor){try{e=decodeURIComponent(r[1])}catch(a){e=r[1]}s="[[",o="]]"}else if((r=e.match(this.re.devHref))&&!cur.isBLogEditor){try{e=decodeURIComponent(r[1])}catch(a){e=r[1]}s="[[",o="]]"}else(r=e.match(this.re.pageId))&&!cur.isBLogEditor&&(e=r[1],s="[[",o="]]");var c="";if(i){var h=i.getAttribute("onclick");h&&-1!=h.indexOf("inBox")&&(c+="box|")}return(c||e!=t)&&(c+=t),s+e+(c?"|"+c:"")+o},insertLink:function(e,t,i){if(this.plainMode)return this.plainInsert(this.getLinkWiki(t,e),"",{replace:1}),!1;var n=ce("a",{className:i?"wk_ext_link":"",innerHTML:clean(e),href:t});cur.wkLinkEl&&cur.wkLinkEl.parentNode?cur.wkLinkEl.parentNode.replaceChild(n,cur.wkLinkEl):(cur.wkBoxRange&&this.setSelectionRange(cur.wkBoxRange),this.insert([n],!0)),delete cur.wkLinkRange,delete cur.wkLinkEl,this.changed=!0},checkEditPlace:function(){setTimeout(function(){var e=this.getState(this.getRange());this.switchMode(e[1])}.bind(this),0)},toggleState:function(e){var t=clone(this.state);t[e]=!t[e],"left"==e&&t[e]&&(t.center=0,t.left=0,t.right=0),"right"==e&&t[e]&&(t.center=0),"center"==e&&t[e]&&(t.right=0),this.setState(t)},setState:function(e){this.plainMode&&(e.mode=1);var t=["bold","italic","right","center","url","mode","h1","h2","h3","list","blockquote"];for(var i in t)i=t[i],e[i]&&!this.state[i]?addClass(ge("wke_b_"+i),"wke_b_active"):!e[i]&&this.state[i]&&removeClass(ge("wke_b_"+i),"wke_b_active");this.state=e},saveLastCursor:function(){var e=this.getRange(!1,!0);e&&(cur.lastCursor=e)},switchMode:function(e){if(this.mode==e)return!1;var t=!1;if(2==e?t={h1:1,h2:1,h3:1}:3==e?t={url:1}:4==e?t={}:5==e&&(t={bold:1,italic:1,list:1,url:1}),t)for(var i in this.buttons)toggleClass("wke_b_"+i,"wke_b_disabled",!t[i]);else if(this.mode>=2)for(var n in this.buttons)removeClass("wke_b_"+n,"wke_b_disabled");var r=ge("wke_b_url");3==e?(addClass("wke_b_url","wke_b_remove"),r.setAttribute("tooltip",this.buttons.url[1])):3==this.mode&&(removeClass("wke_b_url","wke_b_remove"),this.ttUpdate(r,this.buttons.url[0])),this.mode=e,this.onSwitchMode&&this.onSwitchMode()},getAlign:function(e){return e.style.textAlign||e.getAttribute("align")},getSel:function(){return window.getSelection?window.getSelection():!1},getRangeCont:function(e){return null==e?null:e.commonAncestorContainer?e.commonAncestorContainer:e.parentElement?e.parentElement():e.item(0)},getRange:function(e,t){var i=e?!1:this.getSel(),n=void 0;if(i&&i.rangeCount){n=i.getRangeAt(0);for(var r=this.getRangeCont(n);r;){if(r==this.cont)return n;r=r.parentNode}}return t?!1:(document.createRange?(n=document.createRange(),n.selectNodeContents(this.cont)):(n=document.body.createTextRange(),n.moveToElementText(this.cont)),n.collapse(!1),n)},unsurround:function(e,t){for(var i=document.createDocumentFragment(),n=e.firstChild,r=e.lastChild;e.firstChild;)i.appendChild(e.firstChild);return e.parentNode.replaceChild(i,e),t||this.setSelection(n,r),this.getState(),!1},getRangeText:function(e,t){if(browser.msie){var i=document.selection.createRange();return i.text}if(t&&e.cloneContents){var n=e.cloneContents(),r=this.getText(n,!0);return r}return e+""},surround:function(e,t,i,n,r){var s=this.getRange(),o=this.getRangeText(s,r);if(i=i||"",n=n||"",s.collapsed||!o)t&&(e.innerHTML=i+(t||"header")+n);else{var a="";if(r){o=o.split("\n");for(var c in o)o[c]&&(a+=i+clean(o[c])+n);a||(a=i+(t||"header")+n)}else a=i+clean(o||"")+n;e.innerHTML=a}this.replaceSelected([e])&&(this.cleanContent(this.getRangeCont(s)),this.setFocus(e,{noCollapse:!0}))},cleanContent:function(e){if(1==e.nodeType){var t=[];t.push.apply(t,geByClass("wk_header",e)),t.push.apply(t,geByClass("wk_sub_header",e)),t.push.apply(t,geByClass("wk_sub_sub_header",e));for(var i in t)""===this.getText(t[i])&&re(t[i])}},isLink:function(e){return"A"!=e.tagName||hasClass(e,"wk_photo")||hasClass(e,"wk_photo_no_padding")?!1:!0},isPhoto:function(e){for(;e&&e!=this.cont;){if(this.isPhotoEl(e))return e;e=e.parentNode}return!1},isPhotoEl:function(e){return hasClass(e,"wk_photo")||hasClass(e,"wk_photo_no_padding")||hasClass(e,"wikiPhoto")},isVideo:function(e){return hasClass(e,"wk_video")},isAudio:function(e){return hasClass(e,"audio_row")},getState:function(e){var t=this.getRangeCont(e),i=void 0,n=void 0;e&&(i=e.startContainer,n=e.endContainer);for(var r=!1,s=0,o=i,a={};o;){(i&&o==t||o==n)&&(i=!1,o=n);var c=o.tagName;if(1==o.nodeType){switch(c){case"B":case"STRONG":a.bold=1;break;case"I":case"EM":a.italic=1;break;case"PRE":a.pre=1}this.testRight(o)&&(a.right=1),this.testCenter(o)&&(a.center=1)}if("LI"==c&&this.fixList(o),!s){var h=void 0;o.className&&(h=o.className.match(this.re.header)),h?(h[2]?a.h3=1:h[1]?a.h2=1:h[0]&&(a.h1=1),r=o,s=2,(a.right||a.center)&&this.fixHeader(o)):this.isLink(o)?(r=o,s=3):"PRE"==c?(r=o,s=4):"UL"==c||"OL"==c?(r=o,s=5,a.list=1):"BLOCKQUOTE"==c&&(r=o,s=6,a.blockquote=1)}if(o==this.cont)break;o=o.parentNode}return this.setState(a),[r,s]},replaceSelected:function(e){this.checkFocus();var t=this.getRange();if(t.deleteContents&&!browser.msie){if(t.deleteContents(),browser.opera){document.execCommand("insertHTML",!1,'<span id="wke_tmp_el"></span>');var i=ge("wke_tmp_el");for(var n in e)i.parentNode.insertBefore(e[n],i);re(i)}else for(var r in e)t.insertNode(e[r]);return!0}var s=document.selection.createRange(),o="";for(var a in e)o+=e[a].outerHTML;return s.pasteHTML(o),s.collapse(!1),s.select(),!1},insert:function(e,t,i){if(this.replaceSelected(e)){var n=e[0];if(t||n.previousSibling&&"BR"==n.previousSibling.nodeName||n.parentNode.insertBefore(ce("br"),n),n=e[e.length-1],!n.nextSibling||"BR"!=n.nextSibling.nodeName&&1==n.nodeType&&(!n.nextSibling.data||!n.nextSibling.data.match(this.re.letter))){var r=ce("br");n.parentNode.appendChild(r)}i?this.setFocus(n):this.setFocus(n.nextSibling)}},editable:function(e){return e&&3!=e.nodeType&&e.getAttribute&&"true"==e.getAttribute("contenteditable")},setSelection:function(e,t){var i=this.getRange();i.setStartBefore(e),i.setEndAfter(t),this.setSelectionRange(i)},plainFocus:function(e,t,i){if(browser.msie&&document.selection){for(var n=e.value,r=t,s=0;r>s;s++)"\r"==n[s]&&(t-=1,i-=1);for(r=i;r>s;s++)"\r"==n[s]&&(i-=1)}elfocus(e,t,i)},setSelectionRange:function(e){if(this.plainMode)return void this.plainFocus(this.textarea,e[0],e[1]);var t=this.getSel();t.removeAllRanges(),t.addRange(e)},setFocus:function(e,t){var i=this.getSel(),n=this.getRange();if(t||(t={}),i)i.removeAllRanges(),cur.lastCursor?(n=cur.lastCursor,n.collapse(!1)):(void 0!=t.offset?(n.setStart(e,0),n.setEnd(e,0)):n.selectNodeContents(e),t.noCollapse||n.collapse(t.toStart||!1)),i.addRange(n);else if(n=document.body.createTextRange(),3!=e.nodeType)try{n.moveToElementText(e),t.noCollapse||n.collapse(t.toStart||!1),n.select()}catch(r){}return n},insertAudio:function(e,t,i,n,r,s,o){if(this.abox.hide(),this.plainMode)return this.plainInsert("[[audio"+n+"]]","",{replace:1}),!1;o=geByClass1("_audio_row",domPN(o));var a=AudioUtils.getAudioFromEl(o),c=AudioUtils.drawAudio(a),h=se(c);h.setAttribute("contenteditable","false"),this.insert([h])},insertVideo:function(e,t,i,n,r){return this.vbox.hide(),this.plainMode?(this.plainInsert("[[video"+r+"]]","",{replace:1}),!1):(this.getImgSize(e,function(i,s){if(i>this.imgWidth+20){var o=this.imgWidth/i;i=this.imgWidth,s=Math.floor(s*o)}if(s>this.imgWidth+20){var a=this.imgWidth/s;s=this.imgWidth,i=Math.floor(i*a)}var c=se('<a class="wk_video" href="'+n+'" contentEditable="false" onclick="return showVideo(\''+r+"', '', {autoplay: 1}, event)\"><img alt=\""+t+'" title="'+t+'" src="images/play_video_wide.png@3" style="background-image: url('+e+');">');this.insert([c])}.bind(this)),!1)},getPhotoHTML:function(e,t,i,n,r,s,o){var a="width: "+n+"px; height: "+r+"px;",c=void 0;s?(s=clean(s),c="return goAway('"+s+"')"):(s="photo"+e+"_"+t,c="return "+this.inst+".editPhoto(this);");var h="";return o&&(h=' title="'+clean(o)+'"'),'<a contenteditable="false"'+h+' class="wk_photo" wiki="'+e+"_"+t+'" href="'+s+'" onclick="'+c+'"><img src="'+i+'" style="'+a+'" /></a>'},insertPhoto:function(e,t,i,n){return this.pbox.showProgress(),this.getImgSize(n,function(i,r){if(this.pbox.hide(),i>this.imgWidth+20){var s=this.imgWidth/i;i=this.imgWidth,r=Math.floor(r*s)}if(r>this.imgWidth+20){var o=this.imgWidth/r;r=this.imgWidth,i=Math.floor(i*o)}return this.plainMode?(this.plainInsert("[[photo"+e+"_"+t+"|"+i+"x"+r+"px;noborder| ]]","",{replace:1}),!1):void this.insert([ce("div",{align:"center",innerHTML:this.getPhotoHTML(e,t,n,i,r)})])}.bind(this)),!1},getImgSize:function(e,t){var i=ce("img",{src:e});i.onload=function(){var e=getSize(i);t(e[0],e[1]),re(i)},this.loader.appendChild(i)},editPhoto:function(){return!1},ttOver:function(e,t){return hasClass(e,"wke_b_disabled")?!1:void showTooltip(e,{text:function(){return e.getAttribute("tooltip")},shift:[0,8,8],asrtl:t,className:"wke_tt"+(t?" wke_tt_right":""),black:1})},ttUpdate:function(e,t){e.setAttribute("tooltip",t),e.tt&&(e.tt.show&&e.tt.show(),window.tooltips&&tooltips.rePositionTT(e.tt))},isCont:function(e){if(!e)return!1;var t=e.nodeName;return"DIV"==t||"TABLE"==t||"UL"==t||"OL"==t||"PRE"==t||"BLOCKQUOTE"==t||this.editable(e)?!0:!1},inBold:function(e){for(;e;){var t=e.nodeName;if("B"==t||"STRONG"==t)return!0;if(e==this.cont)return!1;e=e.parentNode}return!1},inItalic:function(e){for(;e;){var t=e.nodeName;if("I"==t||"EM"==t)return!0;if(e==this.cont)return!1;e=e.parentNode}return!1},cleanPrep:function(e){return e.replace(this.re.notWords,"")},lastNode:function(e){for(var t=e.lastChild;t&&3==t.nodeType&&""==trim(t.nodeValue);)t=t.previousSibling;return t},prevNode:function(e){for(var t=e.previousSibling;t&&3==t.nodeType&&""==trim(t.nodeValue);)t=t.previousSibling;return t},getWikiHref:function(e){var t=e.getAttribute("href"),i=t.match(this.re.pageId);return i?i[1]:t},getPhotoOpts:function(e,t){t||(t=[]),hasClass(e,"wk_photo_right")&&t.unshift("right"),hasClass(e,"wk_photo_left")&&t.unshift("left"),hasClass(e,"wk_photo_center")&&t.unshift("center");var i="IMG"==e.tagName?e:geByTag1("img",e),n=getSize(i);return t.unshift(n[0]+"x"+n[1]+"px"),t.join(";")},getElementWiki:function(e,t){var i="",n="",r=!1,s=e.nodeName;("TD"==s||"TH"==s)&&(t|=1),"PRE"==s&&(t|=2),"LI"==s&&(t|=3);var o=this.getContent(e,t),a=void 0,c=void 0,h=void 0;switch(s){case"P":o=o.replace(this.re.trimSp,""),h=e.previousSibling,h&&!this.isCont(h)&&"BR"!=h.nodeName&&(i="\n"),o?this.testLeft(e)?(i="<left>",n="</left>\n"):this.testRight(e)?(i="<right>",n="</right>\n"):this.testCenter(e)&&(i="<center>",n="</center>\n"):r="\n";break;case"DIV":o=o.replace(this.re.trimSp,"");var l=e.className.match(this.re.header);if(l){var u=void 0;u=l[2]?"====":l[1]?"===":"==",r=u+this.getText(e).replace("\n","")+u+"\n"}else if(hasClass(e,"audio_row")){var d=e.getAttribute("data-full-id");d&&(r="[[audio"+d+"]]")}else{if(""==o)break;if("\n"!=o.substr(-1)){var p=this.lastNode(e);p&&"PRE"==p.tagName||(n="\n")}var f=this.prevNode(e);f&&!this.isCont(f)&&"BR"!=f.tagName&&(i="\n"),o?this.testLeft(e)?(i+="<left>",n="</left>\n"):this.testRight(e)?(i+="<right>",n="</right>\n"):this.testCenter(e)&&(i+="<center>",n="</center>\n"):n="\n"}break;case"CENTER":o=o.replace(this.re.trimSp,""),"\n"!=o.substr(-1)&&(n="\n"),i+="<center>",n="</center>"+n;break;case"BR":n="\n",1&t&&!cur.isBLogEditor?n+="<br/>":3&t&&(n="<br/>"+n);break;case"B":case"STRONG":a=o.split("\n"),c=[];var g=this.inBold(e.parentNode);for(var v in a){var b=a[v];"=="!=b.substr(0,2)&&b.match(this.re.letter)&&!g?c.push("'''"+b+"'''"):c.push(b)}r=c.join("\n");break;case"I":case"EM":a=o.split("\n"),c=[];var w=this.inItalic(e.parentNode);for(var m in a){var k=a[m];"=="!=k.substr(0,2)&&k.match(this.re.letter)&&!w?c.push("''"+k+"''"):c.push(k)}r=c.join("\n");break;case"IMG":if(this.isPhotoEl(e)){var _=this.cleanPrep(e.getAttribute("title")||" "),x=e.getAttribute("wiki");x&&(x=x.split("_"),r="[[photo"+x[0]+"_"+(x[1]||"")+"|"+this.getPhotoOpts(e,["nolink"])+"|"+_+"]]")}break;case"A":if(this.isPhotoEl(e)){var y=e.href.match(this.re.photoHref),C=this.cleanPrep(e.getAttribute("title")||" ");if(y)r="[[photo"+y[1]+(y[2]||"")+"|"+this.getPhotoOpts(e)+"|"+C+"]]";else{var E=e.getAttribute("wiki");E&&(E=E.split("_"),r="[[photo"+E[0]+"_"+(E[1]||"")+"|"+this.getPhotoOpts(e)+"|"+this.getWikiHref(e)+"]]")}}else if(hasClass(e,"wk_video")){var T=e.href.match(this.re.videoHref);T&&(r="[[video"+T[1]+(T[2]||"")+"]]")}else{var S=e.getAttribute("href");if(!S)break;var R=S.match(this.re.noteHref);if(R){r="[[note"+R[1]+"_"+R[2]+"|"+this.getText(e)+"]]";break}var B=S.match(this.re.pageWikiHref);if(B){r="[[page"+B[1]+"_"+B[2]+"|"+this.getText(e)+"]]";break}var N=S.match(this.re.topicHref);if(N){r="[[topic"+N[1]+"_"+N[2]+"|"+this.getText(e)+"]]";break}var P=S.match(this.re.photoHref);if(P){var A=geByTag1("img",e);if(A){cur.ii=A;var L=this.cleanPrep(e.getAttribute("title")||" ");r="[[photo"+P[1]+(P[2]||"")+"|"+this.getPhotoOpts(e)+"|"+L+"]]";break}}r=this.getLinkWiki(S,this.getText(e),e);
}break;case"PRE":var M=this.getText(e);M=M.replace(this.re.n,"\r\n"),r="<pre>"+M+"</pre>";break;case"BLOCKQUOTE":o=o.replace(this.re.trimSp,""),i="<blockquote>";var H=o.substr(0,1);("*"==H||"#"==H)&&(i+="\n"),n="</blockquote>"+n;break;case"CODE":o=o.replace(this.re.trimSp,""),i="<code>",n="</code>";break;case"UL":o=o.replace(this.re.trimSp,""),h=this.prevNode(e),h&&!this.isCont(h)&&"BR"!=h.nodeName&&(i="\n");break;case"OL":o=o.replace(this.re.trimSp,""),h=this.prevNode(e),h&&!this.isCont(h)&&"BR"!=h.nodeName&&(i="\n");break;case"LI":var O=o.substr(0,1);if("*"!=O&&"#"!=O){var I=e.parentNode;for(i="* ";I&&I!=this.cont;){if("OL"==I.tagName){i="# ";break}if("Ul"==I.tagName)break;I=I.parentNode}}n="\n",o=o.split("\n");var W="";for(var j in o){var U=o[j].match(this.re.wikiLi);W+=U?(j>0?"\n":"")+U[1]+o[j]:o[j]?(j>0?"\n:":"")+o[j]:"<br/><br/>"}o=W;break;case"DD":o=o.replace(this.re.trimSp,""),i=":";break;case"SPAN":hasClass(e,"wk_gray")&&(i="<gray>",n="</gray>");break;case"U":i="<u>",n="</u>";break;case"S":case"STRIKE":i="<s>",n="</s>";break;case"SUB":i="<sub>",n="</sub>";break;case"SUP":i="<sup>",n="</sup>";break;case"TABLE":i="{|";var F=[];hasClass(e,"wk_table_no_border")&&F.push("noborder"),hasClass(e,"wk_table_no_margin")&&F.push("nomargin");var D=geByTag1("td",e);hasClass(D,"wk_cell_no_padding")&&F.push("nopadding"),F.length&&(i+=F.join(";"));for(var K=e.firstChild,G=[];K;){var V=K.tagName;if("COLGROUP"!=V){if("COL"==V){var z=K.getAttribute("style").match(this.re.colWidth);z&&G.push(intval(z[1]))}K=K.nextSibling}else K=K.firstChild}G.length&&(i+="\n|~ "+G.join(" ")),n="|}";break;case"TR":i="|-\n";break;case"TD":case"TH":o=o.replace(this.re.trimSp,""),i="TH"==s?"! ":"| ","\n"!=o.substr(-1)&&(n="\n"),o=o.replace(this.re.nn,"<br/>")}return r?r:i+this.getWikiBreak(i,o)+o+this.getWikiBreak(o,n)+n},strToWiki:function(e){return e=e.replace(this.re.trimN," "),e=e.replace(this.re.n," "),e=e.replace(this.re.sp," "),e=e.replace(/^#/g,"&#35;").replace(/^\*/g,"&#42;"),e=e.replace(/</g,"&#60;").replace(/>/g,"&#62;"),e=e.replace(/\[/g,"&#91;").replace(/]/g,"&#93;"),e=e.replace(/\{/g,"&#123;").replace(/\}/g,"&#125;"),e=e.replace(/==/g,"&#61;&#61;").replace(/~/g,"&#126;"),e=e.replace(/\|/g,"&#124;").replace(/!/g,"&#33;")},getContent:function(e,t){for(var i=e.firstChild,n="",r=void 0;i;){switch(i.nodeType){case 3:r=this.strToWiki(i.data),"\n"==n.substr(-1)&&(r=r.replace(this.re.startSp,"")),n+=r;break;case 1:r=this.getElementWiki(i,t||0),n+=this.getWikiBreak(n,r)+r;break;case 8:}i=i.nextSibling}return n},getWikiBreak:function(e,t){if(e&&"\n"!=e.substr(-1)){var i=t.substr(0,2);if("=="==i||"|-"==i||"|}"==i||"{|"==i)return"\n";if("|}"==e.substr(-2)&&"\n"==t)return"\n"}return""},getText:function(e,t){if(!e)return"";if(t){for(var i=e.firstChild,n="";i;){switch(i.nodeType){case 3:var r=i.data.replace(this.re.n," ").replace(this.re.sp," ");n+=r;break;case 1:var s=i.tagName;("DIV"==s||"P"==s||"PRE"==s||"BLOCKQUOTE"==s||"CENTER"==s||"RIGHT"==s||"LEFT"==s||"BR"==s)&&(n+="\n"),n+="B"==s||"STRONG"==s?"<b>"+this.getText(i,!0)+"</b>":"I"==s||"EM"==s?"<i>"+this.getText(i,!0)+"</i>":this.getText(i,!0)}i=i.nextSibling}return n}return e.innerText?e.innerText:e.textContent?e.textContent:""},testLeft:function(e){return"left"==e.getAttribute("align")||"left"==e.style.textAlign?!0:!1},testCenter:function(e){return"center"==e.getAttribute("align")||"center"==e.style.textAlign?!0:!1},testRight:function(e){return"right"==e.getAttribute("align")||"right"==e.style.textAlign||hasClass(e,"wk_right")&&!e.style.textAlign?!0:!1},showLengthMsg:function(){this.lengthMsg||setTimeout(showFastBox({title:getLang("global_error")},this.lang.too_long||"text too long",getLang("global_close")).hide,2e3)},onChangeHandler:function(){this.changed=!0,this.onChange&&this.onChange()},val:function(){var e=void 0;if(this.plainMode)e=this.textarea.value;else{if(!this.cont)return!1;e=this.getContent(this.cont,0),e=e.replace(this.re.lineBr,function(e){for(var t=e.length-2,i="";t--;)i+="<br/>";return"\n"+i+"\n"}),this.wikiPref&&(e=this.wikiPref+e)}return e.length>19e3?(this.showLengthMsg(),!1):(this.textarea.value=e,e)},re:{n:new RegExp("\n","g"),nn:new RegExp("\n\n","g"),sp:new RegExp("[ ]+","g"),endSp:new RegExp("[  ]+$"),startSp:new RegExp("^[  ]+"),trimSp:new RegExp("^ | $","g"),trimN:new RegExp("^\n|\n$","g"),letter:new RegExp("[^\\s\n]"),photoHref:new RegExp("photo([-0-9]+)(_[-0-9]+)?"),videoHref:new RegExp("video([-0-9]+)(_[-0-9]+)?"),lineBr:new RegExp("\n([\n]+)\n","g"),header:new RegExp("wk(_sub)?(_sub)?_header"),noteHref:new RegExp("^/?note([0-9]+)_([0-9]+)"),topicHref:new RegExp("^/?topic([-0-9]+)_([0-9]+)"),pageWikiHref:new RegExp("^/?page([-0-9]+)_([0-9]+)"),away:new RegExp("/away\\.php\\?to=([^&]+)"),pageHref:new RegExp("(?:[/|.]vk.com|^)/(?:pages|developers)?(?:.*&)?p=([^&]+)"),devHref:new RegExp("(?:[/|.]vk.com|^)/dev/([^?#]+)"),pageId:new RegExp("[/|.]vk.com/(page[-0-9]+_[-0-9]+)"),audio:new RegExp("audio([-0-9]+)_([-0-9]+)(_[0-9]+)?"),wikiLi:new RegExp("^([*#])"),notWords:new RegExp("([\\[\\]\\(\\)\\|\\/'\"\\*<>]+)","g"),colWidth:new RegExp("width: ([0-9]+)%")}}),window.WkEditor=n;try{stManager.done("wk_editor.js")}catch(o){}},398:function(e,t,i){e.exports=i(377)},467:function(e,t,i){(function(n,r){var s;(function(){"use strict";function o(e){return"function"==typeof e||"object"==typeof e&&null!==e}function a(e){return"function"==typeof e}function c(e){Y=e}function h(e){X=e}function l(){return function(){n.nextTick(g)}}function u(){return function(){z(g)}}function d(){var e=0,t=new ee(g),i=document.createTextNode("");return t.observe(i,{characterData:!0}),function(){i.data=e=++e%2}}function p(){var e=new MessageChannel;return e.port1.onmessage=g,function(){e.port2.postMessage(0)}}function f(){return function(){setTimeout(g,1)}}function g(){for(var e=0;$>e;e+=2){var t=ne[e],i=ne[e+1];t(i),ne[e]=void 0,ne[e+1]=void 0}$=0}function v(){try{var e=i(641);return z=e.runOnLoop||e.runOnContext,u()}catch(t){return f()}}function b(e,t){var i=this,n=i._state;if(n===ae&&!e||n===ce&&!t)return this;var r=new this.constructor(m),s=i._result;if(n){var o=arguments[n-1];X(function(){H(n,r,o,s)})}else P(i,r,e,t);return r}function w(e){var t=this;if(e&&"object"==typeof e&&e.constructor===t)return e;var i=new t(m);return S(i,e),i}function m(){}function k(){return new TypeError("You cannot resolve a promise with itself")}function _(){return new TypeError("A promises callback cannot return that same promise.")}function x(e){try{return e.then}catch(t){return he.error=t,he}}function y(e,t,i,n){try{e.call(t,i,n)}catch(r){return r}}function C(e,t,i){X(function(e){var n=!1,r=y(i,t,function(i){n||(n=!0,t!==i?S(e,i):B(e,i))},function(t){n||(n=!0,N(e,t))},"Settle: "+(e._label||" unknown promise"));!n&&r&&(n=!0,N(e,r))},e)}function E(e,t){t._state===ae?B(e,t._result):t._state===ce?N(e,t._result):P(t,void 0,function(t){S(e,t)},function(t){N(e,t)})}function T(e,t,i){t.constructor===e.constructor&&i===re&&constructor.resolve===se?E(e,t):i===he?N(e,he.error):void 0===i?B(e,t):a(i)?C(e,t,i):B(e,t)}function S(e,t){e===t?N(e,k()):o(t)?T(e,t,x(t)):B(e,t)}function R(e){e._onerror&&e._onerror(e._result),A(e)}function B(e,t){e._state===oe&&(e._result=t,e._state=ae,0!==e._subscribers.length&&X(A,e))}function N(e,t){e._state===oe&&(e._state=ce,e._result=t,X(R,e))}function P(e,t,i,n){var r=e._subscribers,s=r.length;e._onerror=null,r[s]=t,r[s+ae]=i,r[s+ce]=n,0===s&&e._state&&X(A,e)}function A(e){var t=e._subscribers,i=e._state;if(0!==t.length){for(var n,r,s=e._result,o=0;o<t.length;o+=3)n=t[o],r=t[o+i],n?H(i,n,r,s):r(s);e._subscribers.length=0}}function L(){this.error=null}function M(e,t){try{return e(t)}catch(i){return le.error=i,le}}function H(e,t,i,n){var r,s,o,c,h=a(i);if(h){if(r=M(i,n),r===le?(c=!0,s=r.error,r=null):o=!0,t===r)return void N(t,_())}else r=n,o=!0;t._state!==oe||(h&&o?S(t,r):c?N(t,s):e===ae?B(t,r):e===ce&&N(t,r))}function O(e,t){try{t(function(t){S(e,t)},function(t){N(e,t)})}catch(i){N(e,i)}}function I(e){return new ve(this,e).promise}function W(e){function t(e){S(r,e)}function i(e){N(r,e)}var n=this,r=new n(m);if(!Q(e))return N(r,new TypeError("You must pass an array to race.")),r;for(var s=e.length,o=0;r._state===oe&&s>o;o++)P(n.resolve(e[o]),void 0,t,i);return r}function j(e){var t=this,i=new t(m);return N(i,e),i}function U(){throw new TypeError("You must pass a resolver function as the first argument to the promise constructor")}function F(){throw new TypeError("Failed to construct 'Promise': Please use the 'new' operator, this object constructor cannot be called as a function.")}function D(e){this._id=fe++,this._state=void 0,this._result=void 0,this._subscribers=[],m!==e&&("function"!=typeof e&&U(),this instanceof D?O(this,e):F())}function K(e,t){this._instanceConstructor=e,this.promise=new e(m),Array.isArray(t)?(this._input=t,this.length=t.length,this._remaining=t.length,this._result=new Array(this.length),0===this.length?B(this.promise,this._result):(this.length=this.length||0,this._enumerate(),0===this._remaining&&B(this.promise,this._result))):N(this.promise,this._validationError())}function G(){var e;if("undefined"!=typeof r)e=r;else if("undefined"!=typeof self)e=self;else try{e=Function("return this")()}catch(t){throw new Error("polyfill failed because global object is unavailable in this environment")}var i=e.Promise;(!i||"[object Promise]"!==Object.prototype.toString.call(i.resolve())||i.cast)&&(e.Promise=ge)}var V;V=Array.isArray?Array.isArray:function(e){return"[object Array]"===Object.prototype.toString.call(e)};var z,Y,q,Q=V,$=0,X=function(e,t){ne[$]=e,ne[$+1]=t,$+=2,2===$&&(Y?Y(g):q())},J="undefined"!=typeof window?window:void 0,Z=J||{},ee=Z.MutationObserver||Z.WebKitMutationObserver,te="undefined"!=typeof n&&"[object process]"==={}.toString.call(n),ie="undefined"!=typeof Uint8ClampedArray&&"undefined"!=typeof importScripts&&"undefined"!=typeof MessageChannel,ne=new Array(1e3);q=te?l():ee?d():ie?p():void 0===J?v():f();var re=b,se=w,oe=void 0,ae=1,ce=2,he=new L,le=new L,ue=I,de=W,pe=j,fe=0,ge=D;D.all=ue,D.race=de,D.resolve=se,D.reject=pe,D._setScheduler=c,D._setAsap=h,D._asap=X,D.prototype={constructor:D,then:re,"catch":function(e){return this.then(null,e)}};var ve=K;K.prototype._validationError=function(){return new Error("Array Methods must be provided an Array")},K.prototype._enumerate=function(){for(var e=this.length,t=this._input,i=0;this._state===oe&&e>i;i++)this._eachEntry(t[i],i)},K.prototype._eachEntry=function(e,t){var i=this._instanceConstructor,n=i.resolve;if(n===se){var r=x(e);if(r===re&&e._state!==oe)this._settledAt(e._state,t,e._result);else if("function"!=typeof r)this._remaining--,this._result[t]=e;else if(i===ge){var s=new i(m);T(s,e,r),this._willSettleAt(s,t)}else this._willSettleAt(new i(function(t){t(e)}),t)}else this._willSettleAt(n(e),t)},K.prototype._settledAt=function(e,t,i){var n=this.promise;n._state===oe&&(this._remaining--,e===ce?N(n,i):this._result[t]=i),0===this._remaining&&B(n,this._result)},K.prototype._willSettleAt=function(e,t){var i=this;P(e,void 0,function(e){i._settledAt(ae,t,e)},function(e){i._settledAt(ce,t,e)})};var be=G,we={Promise:ge,polyfill:be};s=function(){return we}.call(t,i,t,e),!(void 0!==s&&(e.exports=s)),be()}).call(this)}).call(this,i(756),i(364))},587:function(e,t,i){"use strict";function n(){var e=null,t=window.getSelection();t.getRangeAt&&t.rangeCount&&(e=t.getRangeAt(0));var i=null,n=null,r=0,s=0,o=document.activeElement;return e&&("selectionStart"in o?(i=o,n=o,r=o.selectionStart,s=o.selectionEnd):t.rangeCount&&(i=e.startContainer,n=e.endContainer,r=e.startOffset,s=e.endOffset)),[e,i,r,n,s]}function r(e){var t=window.getSelection();return t.removeAllRanges(),t.addRange(e),e}function s(e,t,i,n){var s=document.createRange();return s.setStart(e,t),s.setEnd(i,n),r(s)}function o(e,t){if(t=t?t+"":"",!browser.msie&&document.execCommand)document.execCommand("insertHTML",!1,t);else if(e){e.deleteContents();var i=cf(t),n=i.lastChild;e.insertNode(i),n&&(e=e.cloneRange(),e.setStartAfter(n),e.collapse(!0),r(e))}return e}i.r(t),i.d(t,"rangeGet",function(){return n}),i.d(t,"rangeSet",function(){return r}),i.d(t,"rangeCreate",function(){return s}),i.d(t,"rangeInsert",function(){return o})},641:function(e,t){},756:function(e,t){function i(){throw new Error("setTimeout has not been defined")}function n(){throw new Error("clearTimeout has not been defined")}function r(e){if(l===setTimeout)return setTimeout(e,0);if((l===i||!l)&&setTimeout)return l=setTimeout,setTimeout(e,0);try{return l(e,0)}catch(t){try{return l.call(null,e,0)}catch(t){return l.call(this,e,0)}}}function s(e){if(u===clearTimeout)return clearTimeout(e);if((u===n||!u)&&clearTimeout)return u=clearTimeout,clearTimeout(e);try{return u(e)}catch(t){try{return u.call(null,e)}catch(t){return u.call(this,e)}}}function o(){g&&p&&(g=!1,p.length?f=p.concat(f):v=-1,f.length&&a())}function a(){if(!g){var e=r(o);g=!0;for(var t=f.length;t;){for(p=f,f=[];++v<t;)p&&p[v].run();v=-1,t=f.length}p=null,g=!1,s(e)}}function c(e,t){this.fun=e,this.array=t}function h(){}var l,u,d=e.exports={};!function(){try{l="function"==typeof setTimeout?setTimeout:i}catch(e){l=i}try{u="function"==typeof clearTimeout?clearTimeout:n}catch(e){u=n}}();var p,f=[],g=!1,v=-1;d.nextTick=function(e){var t=new Array(arguments.length-1);if(arguments.length>1)for(var i=1;i<arguments.length;i++)t[i-1]=arguments[i];f.push(new c(e,t)),1!==f.length||g||r(a)},c.prototype.run=function(){this.fun.apply(null,this.array)},d.title="browser",d.browser=!0,d.env={},d.argv=[],d.version="",d.versions={},d.on=h,d.addListener=h,d.once=h,d.off=h,d.removeListener=h,d.removeAllListeners=h,d.emit=h,d.prependListener=h,d.prependOnceListener=h,d.listeners=function(e){return[]},d.binding=function(e){throw new Error("process.binding is not supported")},d.cwd=function(){return"/"},d.chdir=function(e){throw new Error("process.chdir is not supported")},d.umask=function(){return 0}}});